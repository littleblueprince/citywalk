<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>citywalk</title>
    <link rel="icon" type="image/png" sizes="16x16" href="../static/images/p4.png">
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<script charset="utf-8"
    src="https://map.qq.com/api/gljs?v=1.exp&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77"></script>
<style type="text/css">
    html,
    body {
        height: 100%;
        margin: 0px;
        padding: 0px;
    }

    #container {
        width: 100%;
        height: 100%;
    }

    #info {
        position: absolute;
        left: 30px;
        top: 30px;
        background: #FFF;
        width: 350px;
        height: 120px;
        padding: 10px;
        border-radius: 3px;
    }

    p,
    h4 {
        margin: 0;
        padding: 0;
        margin-bottom: 10px;
    }
    h4{
        margin-top: 30px;
    }
    #add {
        position: absolute;
        left:10px;
        top: 10px;
        z-index: 9999;
    }
    #remove{
        position: absolute;
        left: 120px;
        top: 10px;
        z-index: 9999;
    }
</style>

<body>
    <div id="container"></div>
    <div id="info">
        <input type="button" id="add" value="开始选择" onclick="addClick()">
        <input type="button" id="remove" value="锁定所选项" onclick="removeClick()">
        <h4 id="txt"></h4>
        <p id="position">当前已选择:</p>
        <button>提交</button>
    </div>

    <script>
        var txt = document.getElementById("txt");

        var position = document.getElementById("position");

        var center = new TMap.LatLng(39.984104, 116.307503);//设置中心点坐标
        //初始化地图
        var map = new TMap.Map("container", {
            center: center
        });

        //初始化marker
        var marker = new TMap.MultiMarker({
            id: 'marker-layer',
            map: map,
            styles: {
                "marker": new TMap.MarkerStyle({
                    "width": 25,
                    "height": 35,
                    "anchor": { x: 16, y: 32 },
                    "src": 'https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/markerDefault.png'
                })
            },
            geometries: [{
                "id": "marker1",
                "styleId": 'marker',
                "position": new TMap.LatLng(39.954104, 116.357503),
                "properties": {
                    "title": "marker1"
                }
            }, {
                "id": "marker2",
                "styleId": 'marker',
                "position": new TMap.LatLng(39.994104, 116.287503),
                "properties": {
                    "title": "marker2"
                }
            }, {
                "id": "marker3",
                "styleId": 'marker',
                "position": new TMap.LatLng(39.984104, 116.307503),
                "properties": {
                    "title": "marker3"
                }
            }

            ]
        });
        var arr=[];
        //监听回调函数（非匿名函数）
        var eventClick = function (evt) {
            if(arr.includes(evt.geometry.id)){
                element = evt.geometry.id
                var new_set = new Set(arr)
                new_set.delete(element)
                arr = [...new_set]
            }
            else {
                arr.push(evt.geometry.id)
            }
            let str=""
            for (let arrKey in arr) {
                str=str+arr[arrKey]+' '
            }
            position.innerHTML = "已选择: " +str;
            console.log(arr)
        }
        function addClick() {
            txt.innerHTML = "选择状态";
            //监听marker点击事件
            marker.on("click", eventClick)
        }

        function removeClick() {
            txt.innerHTML = "已锁定";
            //移除绑定事件
            marker.off("click", eventClick);
        }

    </script>
</body>

</html>